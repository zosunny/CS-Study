## IoC(Inversion of Control)

<aside>
  
ğŸ’¡ ì œì–´ì˜ ì—­ì „.  <ì œì–´ì˜ íë¦„ì„ ë°”ê¾¼ë‹¤.>

</aside>

- ì˜ì¡´ì„±ì„ ì—­ì „ì‹œì¼œ ê°ì²´ ê°„ì˜ ê²°í•©ë„ë¥¼ ì¤„ì´ê³  ìœ ì—°í•œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆê²Œ ëœë‹¤. â†’ ê°ì²´ì§€í–¥ì„ ìœ„í•œ ê²ƒ
- í”„ë¡œê·¸ë¨ì˜ íë¦„(ê°ì²´ì˜ ìƒì„±, ìƒëª… ì£¼ê¸°, ê°ì²´ ê°„ì˜ ì˜ì¡´ê´€ê³„ ë“±)ì„ ê°œë°œìê°€ ì§ì ‘ ì œì–´í•˜ì§€ ì•Šê³  ì™¸ë¶€ í”„ë ˆì„ì›Œí¬ì—ì„œ ì œì–´í•˜ê³  ê´€ë¦¬í•´ì£¼ëŠ” ê²ƒ
    
      â†’ ì´ë¥¼ í”„ë ˆì„ì›Œí¬ì™€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì°¨ì´ì ìœ¼ë¡œë„ ë³¼ ìˆ˜ ìˆë‹¤.
    
- â“Â `ì˜ì¡´ì„±ì„ ì—­ì „ì‹œí‚¨ë‹¤` ì˜ ì˜ë¯¸ëŠ” ë¬´ì—‡ì¼ê¹Œ?
    
    **ì˜ˆì‹œğŸ‘‡**
    
    ```java
    @Service
    public class UserService{
    
    	private final EnrollManager enrollManager;
    	
    	@Autowired
    	public UserService(EnrollManager enrollManager){
    		this.enrollManager = enrollManager;
    	}
    	...
    }
    ```
    
    ìœ„ ì†ŒìŠ¤ ì½”ë“œì—ì„œëŠ”, ê°œë°œìê°€ ì§ì ‘ UserServiceì—ì„œ ì˜ì¡´í•˜ëŠ” EnrollManager ê°ì²´ë¥¼ ì£¼ì…í•˜ì§€ ì•Šì€ ìƒíƒœì´ë‹¤.
    
    ```java
    @Component
    public class DefaultEnrollManager implements EnrollManager{
    	...
    }
    
    @Profile("test")
    @Component
    public class TestEnrollManager implements EnrollManager{
    	...
    }
    ```
    
    ìœ„ì˜ ì„¤ì •ì„ í†µí•˜ì—¬ spring í”„ë ˆì„ì›Œí¬ì—ì„œëŠ”, `test` profile í™˜ê²½ì—ì„  TestEnrollManager ê°ì²´ê°€ ì£¼ì…ë˜ì–´ ì˜ì¡´ê´€ê³„ê°€ ì„¤ì •ë˜ê³ , ë‚˜ë¨¸ì§€ default í™˜ê²½ì—ì„œëŠ” DefaultEnrollManagerê°€ ì£¼ì…ë˜ê²Œ ëœë‹¤. â†’ ì‘ì„±ëœ ì½”ë“œì˜ ìˆ˜í–‰(ê°ì²´ ì£¼ì…, ì˜ì¡´ê´€ê³„ ì„¤ì • ë“±) ì œì–´ ì±…ì„ì´ í”„ë ˆì„ì›Œí¬ì—ê²Œ ìœ„ì„ë˜ì—ˆìŒ â†’ `**ì œì–´ì˜ ì—­ì „**`
    

## DI(Dependency Injection)

<aside>
  
ğŸ’¡ **ì¸í„°í˜ì´ìŠ¤** íƒ€ì…ì˜ íŒŒë¼ë¯¸í„°ë¥¼ í†µí•˜ì—¬ ì˜ì¡´ ê´€ê³„ë¥¼ ì„¤ì •í•˜ëŠ” ë°©ì‹

</aside>

- ê°•í•œ ê²°í•©ì´ ì•„ë‹Œ ëŠìŠ¨í•œ ê²°í•©ì„ ìˆ˜í–‰í•¨ìœ¼ë¡œì¨(ì˜ì¡´ê´€ê³„ì˜ ì£¼ì…ì„ ëŸ°íƒ€ì„ ì‹œì— í–‰í•¨.) SOLIDì›ì¹™(Open-Closed Principle)ì„ ì§€í‚¤ê²Œ í•¨.
- ì˜ì¡´ì„± ê°ì²´ë¥¼ ì²˜ìŒ êµ¬ë™ ì‹œ ìƒì„±í•˜ê³ , í•„ìš”í•  ë•Œë§ˆë‹¤ ì£¼ì…ì‹œí‚¤ëŠ” ë°©ì‹ìœ¼ë¡œ, ì‹±ê¸€í„´ íŒ¨í„´ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.
- **IoCë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë””ìì¸ íŒ¨í„´ ì¤‘ í•˜ë‚˜**

### Springì—ì„œì˜ DI ë°©ì‹

1. í•„ë“œë¥¼ ì´ìš©í•œ ì˜ì¡´ê´€ê³„ ì£¼ì…(Field injection)
    
    ```java
    @Service
    public class UserService{
    
    	@Autowired
    	private final EnrollManager enrollManager;
    	...
    }
    ```
    
2. setter() ë©”ì„œë“œë¥¼ í†µí•œ ì˜ì¡´ê´€ê³„ ì£¼ì…(Setter injection)
    
    ```java
    @Service
    public class UserService{
    
    	private EnrollManager enrollManager;
    	
    	@Autowired
    	public void setEnrollManager(EnrollManager enrollManager){
    		this.enrollManager = enrollManager;
    	}
    	...
    }
    ```
    
3. ìƒì„±ìë¥¼ ì´ìš©í•œ ì˜ì¡´ê´€ê³„ ì£¼ì…(Constructor injection)
    
    ```java
    @Service
    public class UserService{
    
    	private final EnrollManager enrollManager;
    	
    	@Autowired
    	public UserService(EnrollManager enrollManager){
    		this.enrollManager = enrollManager;
    	}
    	...
    }
    ```
    
    - ìƒì„±ì í˜¸ì¶œ ì‹œì ì— ì˜ì¡´ê´€ê³„ê°€ ì£¼ì…ëœë‹¤.

â†’ ì´ ì¤‘ì—ì„œëŠ” ìƒì„±ìë¥¼ ì´ìš©í•œ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì¶”ì²œëœë‹¤.

- â“Â Constructor injectionì´ ì¶”ì²œë˜ëŠ” ì´ìœ 
    
    ë¨¼ì € í•„ë“œ ì£¼ì…ê³¼ ìˆ˜ì •ì ì£¼ì…ì˜ ë‹¨ì ì€ ì˜ì¡´ê´€ê³„ ê°ì²´ê°€ ì£¼ì…ë˜ì§€ ì•Šì•„ë„ ì–¼ë§ˆë“ ì§€ ê°ì²´ê°€ ìƒì„±ë  ìˆ˜ ìˆë‹¤ëŠ” ì ì— ìˆë‹¤.
    
    â†’ `NPE`ì˜ ìœ„í—˜ì´ ì¡´ì¬í•œë‹¤.
    
    ![í•„ë“œ ì£¼ì… ë°©ì‹ì„ ì‚¬ìš© ì‹œ Intellijì—ì„œë„ ê²½ê³  ë©”ì‹œì§€ë¥¼ ë„ìš°ê³  ìˆë‹¤.](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/1801ff53-e548-4c5f-af80-e18b82d37a9e/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20221118%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20221118T070835Z&X-Amz-Expires=86400&X-Amz-Signature=a61cb3ba33f40dd10a6ad229c716180b526a455f1696b408b3d40a6796c5f12e&X-Amz-SignedHeaders=host&response-content-disposition=filename%3D%22Untitled.png%22&x-id=GetObject)
      
  
    í•„ë“œ ì£¼ì… ë°©ì‹ì„ ì‚¬ìš© ì‹œ Intellijì—ì„œë„ ìœ„ì™€ê°™ì´ ê²½ê³  ë©”ì‹œì§€ë¥¼ ë„ìš°ê³  ìˆë‹¤.
    
    - í•˜ì§€ë§Œ ìƒì„±ì ì£¼ì…ì€ ë‹¤ìŒê³¼ ê°™ì´ **ê°ì²´ ìƒì„± ì‹œì—** ì˜ì¡´ê´€ê³„ê°€ ì£¼ì…ë˜ë¯€ë¡œ, NPEê°€ ë°œìƒí•  ìœ„í—˜ì„±ì´ ì—†ë‹¤.
    - ì˜ì¡´ê´€ê³„ ê°ì²´ì— ëŒ€í•˜ì—¬ `final`ë¡œ ì„ ì–¸ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.
        
        â†’ ì„ ì–¸ê³¼ í•¨ê»˜ ì´ˆê¸°í™”ë˜ë©°, ë³€ê²½ ë¶ˆê°€ëŠ¥
        
    
    ```java
    public class UserService{
    
    	private **final** EnrollManager enrollManager;
    
    	@Autowired
    	public UserService(EnrollManager enrollManager){
    		this.enrollManager = enrollManager;
    	}
    	...
    }
    ```
    
    - ìˆœí™˜ê´€ê³„ ë°œìƒì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.
        
        ```java
        @Service
        public class UserService{
        
        	@Autowired
        	private EnrollManager enrollManager;
        
        	public void enroll(){
        		enrollManager.manage();	
        	}
        	...
        }
        
        @Component
        public class DefaultEnrollManager implements EnrollManager{
        	@Autowired
        	private UserService userService;
        
        	public void manage(){
        		userService.enroll();
        	}
        	...
        }
        ```
        
        ìœ„ì™€ ê°™ì€ í•„ë“œ ì£¼ì… ì‹œì˜ ê²½ìš°, UserService.enroll() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ í˜¸ì¶œì˜ ë°˜ë³µìœ¼ë¡œ ì¸í•˜ì—¬ `StackOverflowError`ê°€ ë°œìƒí•œë‹¤.
        
        ì´ëŸ¬í•œ ìˆœí™˜ ì°¸ì¡° í˜„ìƒì„ í•„ë“œ ì£¼ì…, ìˆ˜ì •ì ì£¼ì… ì‹œ ë¯¸ë¦¬ ì¡ì•„ë‚´ì§€ ëª»í•˜ëŠ” ì´ìœ ëŠ” ìœ„ì˜ ìˆœí™˜ ì°¸ì¡° í˜„ìƒì´ ***ê°ì²´ ìƒì„± ì´í›„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜í–‰ ì‹œì— ë°œìƒí•˜ê¸° ë•Œë¬¸***ì´ë‹¤. â†’ ê°ì²´ ìƒì„±ì‹œì ì—ëŠ” ì´ë¥¼ ì¡ì•„ë‚¼ ìˆ˜ ì—†ë‹¤.
        
        ë§Œì•½ ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±ì ì£¼ì… ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤ë©´
        
        ```java
        @Service
        public class UserService{
        	private EnrollManager enrollManager;
        
        	@Autowired
        	public UserService(EnrollManager enrollManager){
        		this.enrollManager = enrollManager;
        	}
        
        	public void enroll(){
        		enrollManager.manage();	
        	}
        	...
        }
        
        @Component
        public class DefaultEnrollManager implements EnrollManager{
        	private UserService userService;
        
        	@Autowired
        	public DefaultEnrollManager(UserService userService){
        		this.userService = userService;
        	}
        
        	public void manage(){
        		userService.enroll();
        	}
        	...
        }
        ```
        
        ![Untitled](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/9d7f2b2c-6468-4818-8230-d5530ac3243e/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20221118%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20221118T071043Z&X-Amz-Expires=86400&X-Amz-Signature=d2bbba5254aca2f321dc490ee7179639366a7e0818647cb0670b463ee3ddc17f&X-Amz-SignedHeaders=host&response-content-disposition=filename%3D%22Untitled.png%22&x-id=GetObject)
        
        ìœ„ì˜ ê²½ìš°ì²˜ëŸ¼ í”„ë¡œì íŠ¸ ì‹¤í–‰ ì‹œì ì— ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
        
        â†’ ê°ì²´ ìƒì„± ì‹œì ì— ìˆœí™˜ ì°¸ì¡° í˜„ìƒì´ ë°œìƒí•˜ê¸° ë•Œë¬¸
        
    
    ìƒì„±ì ì£¼ì… ë°©ì‹ì˜ ì¥ì ì„ ì •ë¦¬í•˜ë©´
    
    - NPEì˜ ìœ„í—˜ì„±ì„ ì—†ì•¨ ìˆ˜ ìˆë‹¤.
    - ì˜ì¡´ê´€ê³„ì— ëŒ€í•˜ì—¬ finalë¡œ ì„ ì–¸í•˜ì—¬ ë³€ê²½ì— ë”°ë¥¸ ìœ„í—˜ì„±ì„ ì—†ì•¨ ìˆ˜ ìˆë‹¤.
    - ìˆœí™˜ì°¸ì¡° í˜„ìƒì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
    
    ### Reference
    
    [https://yaboong.github.io/spring/2019/08/29/why-field-injection-is-bad/](https://yaboong.github.io/spring/2019/08/29/why-field-injection-is-bad/)
    
    [https://velog.io/@ohzzi/Spring-DIIoC-IoC-DI-ê·¸ê²Œ-ë­”ë°](https://velog.io/@ohzzi/Spring-DIIoC-IoC-DI-%EA%B7%B8%EA%B2%8C-%EB%AD%94%EB%8D%B0)
