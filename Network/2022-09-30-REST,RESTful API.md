# 1. REST(Representational State Transfer)

<aside>
💡 Client와 Server 사이에서 HTTP URL 통해 `자원 명시`, HTTP Method 통해 자원 `조작 요청`하고, `응답`받는 일련의 과정

</aside>

- REST는 웹의 창시자(HTTP) 중의 한 사람인 Roy Fielding의 2000년 논문에 의해 소개 됨.
- 웹의 장점을 최대한 활용할 수 있는 네트워크 기반의 아키텍처로, 자원을 이름으로 구분해 해당 자원의 상태를 주고/받는 모든 것을 의미
- **RESTful API 클라이언트 요청**
    
    > `고유 리소스 식별자` + `메서드` + `HTTP 헤더`
    > 
    - 고유 리소스 식별자
        - URL (리소스에 대한 경로 지정) 사용해 리소스 식별 수행
            - 웹페이지 방문 위해 브라우저에 입력하는 웹 사이트 주소와 유사
            - 요청 엔드포인트라고도 하며 클라이언트가 요구하는 사항을 서버에 명확하게 지정
    - 메서드
        - HTTP(Hypertext Transfer Protocol)사용해 RESTful API 구현
        - HTTP 메서드는 클라이언트가 리소스에 수행해야하는 작업 서버에 알려줌
            - GET : 서버의 지정된 URL에 있는 리소스에 액세스
            - POST : 서버에 데이터 전송. 요청과 함께 데이터 표현 포함 됨. (동일한 요청 여러번 전송하면 동일한 리소스를 여러 번 생성하는 부작용)
            - PUT : 서버의 기존 리소스를 업데이트 (POST와 달리 동일한 요청 여러번 전송해도 결과 동일)
            - DELETE : 리소스를 제거해 서버 상태 변경. 사용자에게 적절한 인증 없으면 요청 실패
    - HTTP 헤더
        - 데이터 : POST, PUT, 기타 HTTP 메서드가 성공적으로 작동하기 위한 데이터 포함
        - 파라미터 : 수행해야 할 작업에 대한 자세한 정보를 서버에 제공하는 파라미터
            - 경로 파라미터 : URL 세부정보 지정
            - 쿼리 파라미터 : 리소스에 대한 추가 정보 요청
            - 쿠키 파라미터 : 클라이언트를 빠르게 인증
- **RESTful API 서버 응답**
    
    > `상태 표시줄` + `메시지 본문` + `헤더`
    > 
    - 상태 표시줄
        - 요청 또는 실패 알리는 3자리 상태 코드 (2XX : 성공, 4XX/5XX : 오류, 3XX : URL 리디렉션)
            - 200 : 일반 성공 응답
            - 201 : POST 메서드 성공 응답
            - 400 : 서버 처리 불가능한 잘못된 요청
            - 404 : 리소스 찾을 수 없음
    - 메시지 본문
        - 리소스 표현 포함
        - 요청 헤더에 포함된 내용 기반 적절한 표현 형식 선택
        - 클라이언트는 XML/JSON(데이터 작성 방식을 일반 텍스트로 정의)형식으로 정보 요청
            - ex) 클라이언트: Jhon의 이름, 나이 요청 → 서버: ‘{”name”:”John”, “age”:30}’ JSON 표현 반환
    - 헤더
        - 응답에 대한 헤더 or 메타데이터 포함
        - 응답에 대한 추가 컨텍스트 제공, 서버/인코딩/날짜 및 콘텐츠 유형과 같은 정보 포함

## REST 핵심 구성 요소

`자원`, `조작`, `표현`

### 1. **자원**

- 서버에 있는 것
- DB 안에 들어가 있는 각각의 데이터 ex) 유저, 주문 등
- 각각의 이미지 ex)[https://www.123rf.com/stock-photo/number_24.html](https://www.123rf.com/stock-photo/number_24.html)
- URL 통해 자원 명시, 구분 가능

### 2. **조작**

- Client는 HTTP Method(POST, GET, DELETE, PUT) 이용해 지정한 자원에 대한 조작 요청

### 3. **표현**

- Client가 Server에게 자원에 대한 조작을 요청하면 Server는 이에 대한 적절한 응답(Representation)을 보냄

## REST의 6가지 기본 원칙

> REST의 기본 원칙 6가지를 지켰을 때, `RESTful` 하다고 표현 함.
> 

### 1. 클라이언트 - 서버 모델

- 클라이언트와 서버 역할이 분리되어, 독립적으로 교체 및 개발 가능
- 사용자 인터페이스와 데이터 처리 영역 분리되어, 유지 보수 쉬워짐

### 2. 무상태 (Stateless)

- 세션 상태가 서버에 저장되어 있지 않은 상태로, 필요에 따라 외부DB에 저장되기도 함
- Server는 요청이 오면 응답보내는 역할만 수행, 세션 관리는 Client에게 책임있음
    - Stateful 서비스와 다르게 `Scaling이 자유롭다`는 장점
    
    ![스크린샷 2022-10-02 오후 3.56.43.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0789975e-c552-4ecc-928c-0be40e44268f/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-10-02_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.56.43.png)
    

![스크린샷 2022-10-02 오후 3.57.14.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d0789c1c-0938-476d-8913-6f2a24c209fe/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-10-02_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.57.14.png)

- `Scale out/Scale up`
    
    *Scale out : 수평확장*
    
    *Scale up : 수직확장*
    

### 3. 캐시 가능

- REST는 웹 표준인 HTTP를 그대로 사용 → 웹에서 사용하는 기존 인프라를 그대로 사용
    - HTTP가 가진 ‘캐싱 기능’ 적용
- HTTP 프로토콜에서 사용하는 태그들 활용해 `캐싱 처리`
- 캐싱 처리
    - 주로 GET요청에서 처리 됨(POST, PUT도 가능하나 잘 사용X)
    - **관련 헤더**
        - **If-Match**
            - Client가 함께 보낸 `ETag` 식별자와 같은 값 있으면 200 응답
            - 다른 값 있으면 `412` http code로 응답, 덮어쓰기 용도로 사용
        - **If-Modifed-Since**
            - Last-Modifed의 값 포기해 전달, 동일한 컨텐츠(최종 수정 시간 같으면)면, `304` http code로 응답
            - 다른 콘텐츠(If-Modifed-Since에 들어간 last-modified 값보다 이후에 데이터 수정되었다면)라면, 200으로 응답
        - **If-None-match**
            - 캐시 확인하기 위한 용도의 헤더 → `조건부 헤더`
            - ETag 식별자와 같은 값이면 cache하기위해 → 304
            - 다른 값이면 정상응답 → 200, 리소스 반환
            - 신규 값 생성, 덮어쓰기 금지 용도로 사용
    - **캐싱 관련 검증 헤더**
        - `ETag`
            - *ETag HTTP 응답 헤더는 특정 버전의 리소스를 특정 문자열로 (일반적으로 MD5 해싱 이용해) 변경시켜 리소스를 식별하는 식별자 (ex. 주민등록번호)*
            - *리소스가 변경되면 이 값도 변경되어 cache 적용이 해제됨.*
            
            ![스크린샷 2022-10-02 오후 5.54.40.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a05191a8-a841-4fc2-b442-1328b93eab50/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-10-02_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.54.40.png)
            
            ![스크린샷 2022-10-02 오후 5.53.34.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/39d65d87-4334-4dc9-824c-881c2dceddbc/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-10-02_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.53.34.png)
            
        - `last-modified`
            - *해당 리소스가 언제 마지막으로 변경되었는지 나타냄*
            - *제일 처음 생성된 Date 날짜보다 빠를 수 없음*
            - *Client는 If-Modifed-Since헤더를 서버에 보내 cache 체크*
            - *서버는 해당 헤더보고 Last-Modifed가 If-Modifed-Since보다 값이 작으면 cache사용하기위해 → 304*
            - *그렇지 않으면 정상응답 → 200, 리소스 반환*
            
            ![스크린샷 2022-10-02 오후 5.59.16.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/849d0939-0f1a-435e-a8f8-440e1cad214f/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-10-02_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.59.16.png)
            
            ![스크린샷 2022-10-02 오후 5.59.37.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/609736f1-2099-4e85-894b-c1487a84b214/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-10-02_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.59.37.png)
            
    - **HTTP 상태 코드**
        - `200` (성공)
            
            *서버가 요청 제대로 처리. 주로 서버가 요청한 페이지를 제공했다는 의미*
            
        - `304` (수정되지 않음)
            
            *마지막 요청 이후 요청한 페이지 수정되지 않음.*
            
            *서버가 이 응답을 표시하면 페이지의 콘텐츠를 표시하지 않음.*
            
            *요청자가 마지막으로 페이지를 요청한 후 페이지가 변경되지 않으면 이 응답(If-Modifed-Since HTTP 헤더)을 표시하도록 서버 구성해야 함.*
            
        - `412` (사전조건 실패)
            
            *대상 리소스에대한 엑세스가 거부됨.*
            
            *서버가 요청자가 요청 시 부과한 사전조건을 만족하지 않음*
            

### 4. 자체 표현 구조

- REST API만 보고도 이를 쉽게 이해할 수 있음

### 5. Layer System (계층화)

- 클라이언트는 REST API 서버만 호출
- 그러나, REST 서버는 다중 계층으로 구성될 수 있음
    - 로드 밸런싱, 암호화 계층 추가해 구조상의 유연성
    - `PROXY`, `게이트웨이` 같은 네트워크 기반의 중간매체를 사용할 수 있음
- 내부 레이어 숨기고, 인접한 레이어에만 공개함으로써 레이어간의 결합 줄임

### 6. Uniform Interface (유니폼 인터페이스)

- HTTP 표준만 따르면 어떤 언어 / 어떤 플랫폼에서 사용해도 사용 가능한 인터페이스 스타일
- 안드로이드 / IOS 플랫폼 등 특정 언어나 플랫폼에 종속되지 않고 사용 가능

## RESTful API 사용 이점

**1. 확장성**

- REST가 클라이언트-서버 상호작용 최적화 → 효율적인 크기 조정 가능
- 무상태(서버가 과거 클라이언트 요청 정보를 유지할 필요X) → 서버 로드 제거
- 잘 관리된 캐싱 → 일부 클라이언트-서버 상호 작용을 부분적 or 완전히 제거
- 이러한 모든 기능 → 성능 저하시키는 `통신 병목 현상 X` 확장성 지원

**2. 유연성**

- 완전한 클라이언트-서버 분리를 지원
- 다양한 서버 구성 요소를 단순화하고 분리해 독립적 발전
- 서버 애플리케이션의 플랫폼/기술 변경 → 클라이언트 애플리케이션에 영향 X
- 애플리케이션 함수 계층화 기능 → 유연성을 더욱 향상
- 개발자는 애플리케이션 로직을 다시 작성하지 않고도 데이터베이스 계층을 변경할 수 있음

**3. 독립성**

- REST API는 사용되는 기술과 독립적
- API 설계에 영향 X, 다양한 프로그래밍 언어로 클라이언트/서버 애플리케이션 모두 작성 가능
- 통신에 영향 X, 양쪽 기본 기술 변경 가능

## REST API 디자인 가이드

1. **URL 의 리소스명은 소문자 사용, 동사보다는 명사 사용**

```wasm
GET    /members/delete/1
```

delete와 같은 행위를 나타내는 표현이 들어가는 것을 지양해야 하며, 단수 명사보다는 복수 명사를 사용

1. **자원에 대한 행위는 HTTP 메서드 통해 표현**

```wasm
DELETE    /members/1
```

회원들 중 id 1번을 가진 회원 삭제

1. **하이픈(-)은 URI의 가독성을 위해 사용. 언더바(_)는 사용하지 않음**

1. **슬래시 구분자(/)는 계층 관계 나타낼 때 사용. URI의 마지막 문자로 사용하면 안됨**

```wasm
GET    /members/1/  (X)
GET    /members/1   (O)
```

1. **파일 확장자는 URI에 포함하지 않음. Aceept header 헤더 사용해 콘텐츠 타입 알려주면 됨.**

### 리소스 간의 관계 표현

1. 소유의 관계 표현

```wasm
GET    /users/{userId}/devices  (유저가 가지고 있는 디바이스 목록)
```

1. 구체적인 표현

```wasm
GET    /users/{userId}/likes/devices (유저가 좋아하는 디바이스 목록)
```

### 응답 메시지 처리

- `2XX`
    - 200 : 클라이언트 요청 정상 수행
    - 201 : POST 통한 리소스 생성 작업 시, 해당 리소스가 성공적으로 생성됨 알림

- `3XX`
    - 301 : 요청한 리소스에 대한 URI가 변경되었을 때, 사용하는 응답 코드

- `4XX`
    - 400 : 클라이언트의 요청이 부적절한 경우
    - 401 : 인증되지 않은 클라이언트의 요청에 대한 응답
    - 403 : 인가되지 않은, 응답하고 싶지 않은 리소스에 접근하려 할 때 응답
    - 405 : 요청 리소스에 대해 사용 불가능한 Method를 이용했을 때 사용하는 응답

- `5XX`
    - 500 : 서버에 문제가 있을 때 사용하는 응답 코드

## Reference

[https://github.com/NKLCWDT/cs/blob/main/Network/Rest.md](https://github.com/NKLCWDT/cs/blob/main/Network/Rest.md)

[https://sabarada.tistory.com/34](https://sabarada.tistory.com/34)

[https://ko.wikipedia.org/wiki/HTTP_상태_코드](https://ko.wikipedia.org/wiki/HTTP_%EC%83%81%ED%83%9C_%EC%BD%94%EB%93%9C)

[https://aws.amazon.com/ko/what-is/restful-api/](https://aws.amazon.com/ko/what-is/restful-api/)
